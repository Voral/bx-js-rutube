this.BX=this.BX||{},function(e){"use strict";var t=function(){function e(){babelHelpers.classCallCheck(this,e),babelHelpers.defineProperty(this,"links",[]),babelHelpers.defineProperty(this,"popup",null),babelHelpers.defineProperty(this,"video",null)}return babelHelpers.createClass(e,[{key:"init",value:function(e){var t=this;void 0!==window.frameCacheVars?BX.addCustomEvent("onFrameDataReceived",(function(i){return t.initItems(e)})):BX.ready((function(i){return t.initItems(e)}))}},{key:"initItems",value:function(e){this.links=document.querySelectorAll(e+"[data-rutube]");for(var t=0,i=this.links.length;t<i;++t)if(!this.links[t].getAttribute("data-rutubeCode")){var r=this.getCode(this.links[t]);""!==r&&(this.links[t].addEventListener("click",this.clickHandler.bind(this),!0),this.links[t].setAttribute("data-rutubeCode",r))}}},{key:"getCode",value:function(e){if(void 0===e.href||""===e.href)return"";var t=e.href.match(/rutube.ru\/video\/([^?\/]+)/);return 2===t.length?t[1]:""}},{key:"clickHandler",value:function(e){var t=e.target.closest("[data-rutube]");e.stopPropagation(),e.preventDefault(),this.renderPopup(),this.renderVideo(t.getAttribute("data-rutubeCode"))}},{key:"closeHandler",value:function(e){e.stopPropagation(),e.preventDefault(),this.removePopup(),this.removeVideo()}},{key:"removePopup",value:function(){this.popup&&this.popup.classList.add("vs-rutube-hide")}},{key:"removeVideo",value:function(){this.video&&(this.video.parentNode.removeChild(this.video),this.video=null)}},{key:"renderPopup",value:function(){if(this.popup)this.popup.classList.remove("vs-rutube-hide");else{this.popup=document.createElement("div"),this.popup.className="vs-rutube-popup",this.popup.addEventListener("click",this.closeHandler.bind(this),!0);var e=document.createElement("div");e.className="vs-rutube-close",this.popup.append(e),document.body.append(this.popup)}}},{key:"calcSize",value:function(){var e=this.popup.clientWidth,t=this.popup.clientHeight,i={width:e>1920?1920:e,height:0};return i.height=Math.floor(.5625*i.width),i.height>t&&(i.width=Math.floor(t/.5625)),i}},{key:"renderVideo",value:function(e){var t=this.calcSize();this.video=document.createElement("div"),this.video.className="vs-rutube-video",this.video.innerHTML='<iframe width="'+t.width+'" height="'+t.height+'" src="https://rutube.ru/play/embed/'+e+'" frameBorder="0" allow="clipboard-write; autoplay" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>',this.popup.append(this.video)}}]),e}();e.RutubeLinks=t}(this.BX.Vasoft=this.BX.Vasoft||{});
//# sourceMappingURL=vasoft-rutube.bundle.js.map
