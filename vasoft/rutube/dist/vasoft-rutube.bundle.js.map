{"version":3,"file":"vasoft-rutube.bundle.js","sources":["../src/application.js"],"sourcesContent":["import './assets/styles.css';\nexport class RutubeLinks {\n    links = [];\n    popup = null;\n    video = null;\n\n    init(className): void {\n        if (window.frameCacheVars !== undefined) {\n            BX.addCustomEvent(\"onFrameDataReceived\", (json) => this.initItems(className));\n        } else {\n            BX.ready((json) => this.initItems(className));\n        }\n    }\n\n    initItems(className): void {\n        this.links = document.querySelectorAll(className + '[data-rutube]');\n        for (let i = 0, c = this.links.length; i < c; ++i) {\n            if (!this.links[i].getAttribute('data-rutubeCode')) {\n                const code = this.getCode(this.links[i]);\n                if (code !== '') {\n                    this.links[i].addEventListener('click', this.clickHandler.bind(this), true);\n                    this.links[i].setAttribute('data-rutubeCode', code);\n                }\n            }\n        }\n    }\n\n    getCode(link) {\n        if (typeof link.href === 'undefined' || link.href === '') {\n            return '';\n        }\n        const result = link.href.match(/rutube.ru\\/video\\/([^?\\/]+)/);\n        return result.length === 2 ? result[1] : '';\n    }\n\n    clickHandler(event): void {\n        const target = event.target.closest('[data-rutube]');\n        event.stopPropagation();\n        event.preventDefault();\n        this.renderPopup();\n        this.renderVideo(target.getAttribute('data-rutubeCode'));\n    }\n\n    closeHandler(event): void {\n        event.stopPropagation();\n        event.preventDefault();\n        this.removePopup();\n        this.removeVideo();\n    }\n\n    removePopup(): void {\n        if (this.popup) {\n            this.popup.classList.add('vs-rutube-hide')\n        }\n    }\n\n    removeVideo(): void {\n        if (this.video) {\n            this.video.parentNode.removeChild(this.video);\n            this.video = null;\n        }\n    }\n\n    renderPopup(): void {\n        if (!this.popup) {\n            this.popup = document.createElement('div');\n            this.popup.className = \"vs-rutube-popup\";\n            this.popup.addEventListener('click', this.closeHandler.bind(this), true);\n\n            let close = document.createElement('div');\n            close.className = \"vs-rutube-close\";\n            this.popup.append(close);\n            document.body.append(this.popup);\n        } else {\n            this.popup.classList.remove('vs-rutube-hide');\n        }\n    }\n\n    calcSize() {\n        let screenWidth = this.popup.clientWidth, screenHeight = this.popup.clientHeight;\n        const result = {\n            width: screenWidth > 1920 ? 1920 : screenWidth,\n            height: 0\n        };\n        result.height = Math.floor(result.width * 0.5625);\n        if (result.height > screenHeight) {\n            result.width = Math.floor(screenHeight / 0.5625);\n        }\n        return result;\n    }\n\n    renderVideo(code): void {\n        const size = this.calcSize();\n        this.video = document.createElement('div');\n        this.video.className = \"vs-rutube-video\";\n        this.video.innerHTML = '<iframe width=\"' + size.width + '\" height=\"' + size.height\n            + '\" src=\"https://rutube.ru/play/embed/' + code\n            + '\" frameBorder=\"0\" allow=\"clipboard-write; autoplay\" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';\n        this.popup.append(this.video);\n    }\n}"],"names":["RutubeLinks","babelHelpers","key","value","className","undefined","window","frameCacheVars","BX","addCustomEvent","json","_this","initItems","ready","this","links","document","querySelectorAll","i","c","length","getAttribute","code","getCode","addEventListener","clickHandler","bind","setAttribute","link","href","result","match","event","target","closest","stopPropagation","preventDefault","renderPopup","renderVideo","removePopup","removeVideo","popup","classList","add","video","parentNode","removeChild","remove","createElement","closeHandler","close","append","body","screenWidth","clientWidth","screenHeight","clientHeight","width","height","Math","floor","size","calcSize","innerHTML"],"mappings":"iDACaA,aAAW,aAAAC,oCAAAA,yCACZ,IAAEA,yCACF,MAAIA,yCACJ,MA+FP,OA/FWA,6BAAAC,WAAAC,eAEPC,GAAiB,gBACYC,IAA1BC,OAAOC,eACPC,GAAGC,eAAe,uBAAuB,SAACC,GAAI,OAAKC,EAAKC,UAAUR,MAElEI,GAAGK,OAAM,SAACH,GAAI,OAAKC,EAAKC,UAAUR,SAEzCF,gBAAAC,eAESC,GACNU,KAAKC,MAAQC,SAASC,iBAAiBb,EAAY,iBACnD,IAAK,IAAIc,EAAI,EAAGC,EAAIL,KAAKC,MAAMK,OAAQF,EAAIC,IAAKD,EAC5C,IAAKJ,KAAKC,MAAMG,GAAGG,aAAa,mBAAoB,CAChD,IAAMC,EAAOR,KAAKS,QAAQT,KAAKC,MAAMG,IACxB,KAATI,IACAR,KAAKC,MAAMG,GAAGM,iBAAiB,QAASV,KAAKW,aAAaC,KAAKZ,OAAO,GACtEA,KAAKC,MAAMG,GAAGS,aAAa,kBAAmBL,QAI7DpB,cAAAC,eAEOyB,GACJ,QAAyB,IAAdA,EAAKC,MAAsC,KAAdD,EAAKC,KACzC,MAAO,GAEX,IAAMC,EAASF,EAAKC,KAAKE,MAAM,+BAC/B,OAAyB,IAAlBD,EAAOV,OAAeU,EAAO,GAAK,MAC5C5B,mBAAAC,eAEY6B,GACT,IAAMC,EAASD,EAAMC,OAAOC,QAAQ,iBACpCF,EAAMG,kBACNH,EAAMI,iBACNtB,KAAKuB,cACLvB,KAAKwB,YAAYL,EAAOZ,aAAa,uBACxCnB,mBAAAC,eAEY6B,GACTA,EAAMG,kBACNH,EAAMI,iBACNtB,KAAKyB,cACLzB,KAAK0B,iBACRtC,kBAAAC,iBAGOW,KAAK2B,OACL3B,KAAK2B,MAAMC,UAAUC,IAAI,qBAEhCzC,kBAAAC,iBAGOW,KAAK8B,QACL9B,KAAK8B,MAAMC,WAAWC,YAAYhC,KAAK8B,OACvC9B,KAAK8B,MAAQ,SAEpB1C,kBAAAC,iBAGG,GAAKW,KAAK2B,MAUN3B,KAAK2B,MAAMC,UAAUK,OAAO,sBAVf,CACbjC,KAAK2B,MAAQzB,SAASgC,cAAc,OACpClC,KAAK2B,MAAMrC,UAAY,kBACvBU,KAAK2B,MAAMjB,iBAAiB,QAASV,KAAKmC,aAAavB,KAAKZ,OAAO,GAEnE,IAAIoC,EAAQlC,SAASgC,cAAc,OACnCE,EAAM9C,UAAY,kBAClBU,KAAK2B,MAAMU,OAAOD,GAClBlC,SAASoC,KAAKD,OAAOrC,KAAK2B,WAIjCvC,eAAAC,iBAGG,IAAIkD,EAAcvC,KAAK2B,MAAMa,YAAaC,EAAezC,KAAK2B,MAAMe,aAC9D1B,EAAS,CACX2B,MAAOJ,EAAc,KAAO,KAAOA,EACnCK,OAAQ,GAMZ,OAJA5B,EAAO4B,OAASC,KAAKC,MAAqB,MAAf9B,EAAO2B,OAC9B3B,EAAO4B,OAASH,IAChBzB,EAAO2B,MAAQE,KAAKC,MAAML,EAAe,QAEtCzB,KACV5B,kBAAAC,eAEWmB,GACR,IAAMuC,EAAO/C,KAAKgD,WAClBhD,KAAK8B,MAAQ5B,SAASgC,cAAc,OACpClC,KAAK8B,MAAMxC,UAAY,kBACvBU,KAAK8B,MAAMmB,UAAY,kBAAoBF,EAAKJ,MAAQ,aAAeI,EAAKH,OACtE,uCAAyCpC,EACzC,yHACNR,KAAK2B,MAAMU,OAAOrC,KAAK8B"}