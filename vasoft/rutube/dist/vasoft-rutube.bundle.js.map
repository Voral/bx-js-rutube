{"version":3,"file":"vasoft-rutube.bundle.js","sources":["../src/application.js"],"sourcesContent":["import './assets/styles.css';\n\nexport class RutubeLinks {\n    links = [];\n    popup = null;\n    video = null;\n\n    init(className): void {\n        if (window.frameCacheVars !== undefined) {\n            BX.addCustomEvent(\"onFrameDataReceived\", (json) => this.initItems(className));\n        } else {\n            BX.ready((json) => this.initItems(className));\n        }\n    }\n\n    initItems(className): void {\n        this.links = document.querySelectorAll(className + '[data-rutube]');\n        for (let i = 0, c = this.links.length; i < c; ++i) {\n            if (!this.links[i].getAttribute('data-rutubeCode')) {\n                const code = this.getCode(this.links[i]);\n                if (code !== '') {\n                    this.links[i].addEventListener('click', this.clickHandler.bind(this), true);\n                    this.links[i].setAttribute('data-rutubeCode', code);\n                }\n            }\n        }\n    }\n\n    getCode(link) {\n        if (typeof link.href === 'undefined' || link.href === '') {\n            return '';\n        }\n        const result = link.href.match(/rutube.ru\\/video\\/([^?\\/]+)/);\n        return result.length === 2 ? result[1] : '';\n    }\n\n    clickHandler(event): void {\n        event.stopPropagation();\n        event.preventDefault();\n        this.renderPopup();\n        this.renderVideo(event.target.getAttribute('data-rutubeCode'));\n    }\n\n    closeHandler(event): void {\n        event.stopPropagation();\n        event.preventDefault();\n        this.removePopup();\n        this.removeVideo();\n    }\n\n    removePopup(): void {\n        if (this.popup) {\n            this.popup.classList.add('vs-rutube-hide')\n        }\n    }\n\n    removeVideo(): void {\n        if (this.video) {\n            this.video.parentNode.removeChild(this.video);\n            this.video = null;\n        }\n    }\n\n    renderPopup(): void {\n        if (!this.popup) {\n            this.popup = document.createElement('div');\n            this.popup.className = \"vs-rutube-popup\";\n            this.popup.addEventListener('click', this.closeHandler.bind(this), true);\n\n            let close = document.createElement('div');\n            close.className = \"vs-rutube-close\";\n            this.popup.append(close);\n            document.body.append(this.popup);\n        } else {\n            this.popup.classList.remove('vs-rutube-hide');\n        }\n    }\n\n    calcSize() {\n        let screenWidth = this.popup.clientWidth, screenHeight = this.popup.clientHeight;\n        const result = {\n            width: screenWidth > 1920 ? 1920 : screenWidth,\n            height: 0\n        };\n        result.height = Math.floor(result.width * 0.5625);\n        if (result.height > screenHeight) {\n            result.width = Math.floor(screenHeight / 0.5625);\n        }\n        return result;\n    }\n\n    renderVideo(code): void {\n        const size = this.calcSize();\n        this.video = document.createElement('div');\n        this.video.className = \"vs-rutube-video\";\n        this.video.innerHTML = '<iframe width=\"' + size.width + '\" height=\"' + size.height\n            + '\" src=\"https://rutube.ru/play/embed/' + code\n            + '\" frameBorder=\"0\" allow=\"clipboard-write; autoplay\" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';\n        this.popup.append(this.video);\n    }\n}"],"names":["RutubeLinks","className","window","frameCacheVars","undefined","BX","addCustomEvent","json","initItems","ready","links","document","querySelectorAll","i","c","length","getAttribute","code","getCode","addEventListener","clickHandler","bind","setAttribute","link","href","result","match","event","stopPropagation","preventDefault","renderPopup","renderVideo","target","removePopup","removeVideo","popup","classList","add","video","parentNode","removeChild","createElement","closeHandler","close","append","body","remove","screenWidth","clientWidth","screenHeight","clientHeight","width","height","Math","floor","size","calcSize","innerHTML"],"mappings":";;;;QAEaA,WAAW;MAAA;QAAA;QAAA,2CACZ,EAAE;QAAA,2CACF,IAAI;QAAA,2CACJ,IAAI;;MAAA;QAAA;QAAA,qBAEPC,SAAS,EAAQ;UAAA;UAClB,IAAIC,MAAM,CAACC,cAAc,KAAKC,SAAS,EAAE;YACrCC,EAAE,CAACC,cAAc,CAAC,qBAAqB,EAAE,UAACC,IAAI;cAAA,OAAK,KAAI,CAACC,SAAS,CAACP,SAAS,CAAC;cAAC;WAChF,MAAM;YACHI,EAAE,CAACI,KAAK,CAAC,UAACF,IAAI;cAAA,OAAK,KAAI,CAACC,SAAS,CAACP,SAAS,CAAC;cAAC;;;;QAEpD;QAAA,0BAESA,SAAS,EAAQ;UACvB,IAAI,CAACS,KAAK,GAAGC,QAAQ,CAACC,gBAAgB,CAACX,SAAS,GAAG,eAAe,CAAC;UACnE,KAAK,IAAIY,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAG,IAAI,CAACJ,KAAK,CAACK,MAAM,EAAEF,CAAC,GAAGC,CAAC,EAAE,EAAED,CAAC,EAAE;YAC/C,IAAI,CAAC,IAAI,CAACH,KAAK,CAACG,CAAC,CAAC,CAACG,YAAY,CAAC,iBAAiB,CAAC,EAAE;cAChD,IAAMC,IAAI,GAAG,IAAI,CAACC,OAAO,CAAC,IAAI,CAACR,KAAK,CAACG,CAAC,CAAC,CAAC;cACxC,IAAII,IAAI,KAAK,EAAE,EAAE;gBACb,IAAI,CAACP,KAAK,CAACG,CAAC,CAAC,CAACM,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACC,YAAY,CAACC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC;gBAC3E,IAAI,CAACX,KAAK,CAACG,CAAC,CAAC,CAACS,YAAY,CAAC,iBAAiB,EAAEL,IAAI,CAAC;;;;;;QAIlE;QAAA,wBAEOM,IAAI,EAAE;UACV,IAAI,OAAOA,IAAI,CAACC,IAAI,KAAK,WAAW,IAAID,IAAI,CAACC,IAAI,KAAK,EAAE,EAAE;YACtD,OAAO,EAAE;;UAEb,IAAMC,MAAM,GAAGF,IAAI,CAACC,IAAI,CAACE,KAAK,CAAC,6BAA6B,CAAC;UAC7D,OAAOD,MAAM,CAACV,MAAM,KAAK,CAAC,GAAGU,MAAM,CAAC,CAAC,CAAC,GAAG,EAAE;;;QAC9C;QAAA,6BAEYE,KAAK,EAAQ;UACtBA,KAAK,CAACC,eAAe,EAAE;UACvBD,KAAK,CAACE,cAAc,EAAE;UACtB,IAAI,CAACC,WAAW,EAAE;UAClB,IAAI,CAACC,WAAW,CAACJ,KAAK,CAACK,MAAM,CAAChB,YAAY,CAAC,iBAAiB,CAAC,CAAC;;;QACjE;QAAA,6BAEYW,KAAK,EAAQ;UACtBA,KAAK,CAACC,eAAe,EAAE;UACvBD,KAAK,CAACE,cAAc,EAAE;UACtB,IAAI,CAACI,WAAW,EAAE;UAClB,IAAI,CAACC,WAAW,EAAE;;;QACrB;QAAA,8BAEmB;UAChB,IAAI,IAAI,CAACC,KAAK,EAAE;YACZ,IAAI,CAACA,KAAK,CAACC,SAAS,CAACC,GAAG,CAAC,gBAAgB,CAAC;;;;QAEjD;QAAA,8BAEmB;UAChB,IAAI,IAAI,CAACC,KAAK,EAAE;YACZ,IAAI,CAACA,KAAK,CAACC,UAAU,CAACC,WAAW,CAAC,IAAI,CAACF,KAAK,CAAC;YAC7C,IAAI,CAACA,KAAK,GAAG,IAAI;;;;QAExB;QAAA,8BAEmB;UAChB,IAAI,CAAC,IAAI,CAACH,KAAK,EAAE;YACb,IAAI,CAACA,KAAK,GAAGxB,QAAQ,CAAC8B,aAAa,CAAC,KAAK,CAAC;YAC1C,IAAI,CAACN,KAAK,CAAClC,SAAS,GAAG,iBAAiB;YACxC,IAAI,CAACkC,KAAK,CAAChB,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACuB,YAAY,CAACrB,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC;YAExE,IAAIsB,KAAK,GAAGhC,QAAQ,CAAC8B,aAAa,CAAC,KAAK,CAAC;YACzCE,KAAK,CAAC1C,SAAS,GAAG,iBAAiB;YACnC,IAAI,CAACkC,KAAK,CAACS,MAAM,CAACD,KAAK,CAAC;YACxBhC,QAAQ,CAACkC,IAAI,CAACD,MAAM,CAAC,IAAI,CAACT,KAAK,CAAC;WACnC,MAAM;YACH,IAAI,CAACA,KAAK,CAACC,SAAS,CAACU,MAAM,CAAC,gBAAgB,CAAC;;;;QAEpD;QAAA,2BAEU;UACP,IAAIC,WAAW,GAAG,IAAI,CAACZ,KAAK,CAACa,WAAW;YAAEC,YAAY,GAAG,IAAI,CAACd,KAAK,CAACe,YAAY;UAChF,IAAMzB,MAAM,GAAG;YACX0B,KAAK,EAAEJ,WAAW,GAAG,IAAI,GAAG,IAAI,GAAGA,WAAW;YAC9CK,MAAM,EAAE;WACX;UACD3B,MAAM,CAAC2B,MAAM,GAAGC,IAAI,CAACC,KAAK,CAAC7B,MAAM,CAAC0B,KAAK,GAAG,MAAM,CAAC;UACjD,IAAI1B,MAAM,CAAC2B,MAAM,GAAGH,YAAY,EAAE;YAC9BxB,MAAM,CAAC0B,KAAK,GAAGE,IAAI,CAACC,KAAK,CAACL,YAAY,GAAG,MAAM,CAAC;;UAEpD,OAAOxB,MAAM;;;QAChB;QAAA,4BAEWR,IAAI,EAAQ;UACpB,IAAMsC,IAAI,GAAG,IAAI,CAACC,QAAQ,EAAE;UAC5B,IAAI,CAAClB,KAAK,GAAG3B,QAAQ,CAAC8B,aAAa,CAAC,KAAK,CAAC;UAC1C,IAAI,CAACH,KAAK,CAACrC,SAAS,GAAG,iBAAiB;UACxC,IAAI,CAACqC,KAAK,CAACmB,SAAS,GAAG,iBAAiB,GAAGF,IAAI,CAACJ,KAAK,GAAG,YAAY,GAAGI,IAAI,CAACH,MAAM,GAC5E,sCAAsC,GAAGnC,IAAI,GAC7C,wHAAwH;UAC9H,IAAI,CAACkB,KAAK,CAACS,MAAM,CAAC,IAAI,CAACN,KAAK,CAAC;;;MAChC;IAAA;;;;;;;;"}